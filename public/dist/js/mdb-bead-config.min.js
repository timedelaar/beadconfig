var debug=!1,baseUrl="/wp-content/plugins/mdb-kralen-config/public";debug&&(baseUrl="http://localhost:50049/"),function(){angular.module("MdbBeadConfig",["MdbControls"])}(),function(){function n(n,t,i,r){function y(){var i=0,r=1,f=0,e=0,o=0,s=0,h=0,c=0,t,l,n;for(i+=r,t=0,l=u.necklace.length;t<l;t++){n=u.necklace[t];i+=parseFloat(n.price);switch(n.type){case"letter_bead":f+=parseFloat(n.price);s++;break;case"spacer_bead":n.size==="big"?(o+=parseFloat(n.price),c++):(e+=parseFloat(n.price),h++)}}u.prices={total:i.toFixed(2),lace:r.toFixed(2),letterBeads:f.toFixed(2),spacerBeadsSmall:e.toFixed(2),spacerBeadsBig:o.toFixed(2)};u.amounts={lace:1,letterBeads:s,spacerBeadsSmall:h,spacerBeadsBig:c}}function b(){u.laceType=i.getLaces()[0];u.necklaceText="";u.necklace=[];u.prices={};u.amounts={};u.updatePrices()}function p(){var t,n,r,i;if(!u.ordered&&typeof u.localStorage!="undefined"){if(u.necklace.length===0){u.localStorage.removeItem("necklace");return}for(t={laceType:u.laceType,necklace:[]},n=0,r=u.necklace.length;n<r;n++)i=u.necklace[n],t.necklace.push({color:i.color,letter:i.letter});u.localStorage.setItem("necklace",JSON.stringify(t))}}function w(){i.loading.then(function(){var n,r,e,f;if(b(),u.defaultColor=i.getColors()[0],typeof u.localStorage=="undefined"){i.stopSpinner();return}if(n=localStorage.getItem("necklace"),!n){i.stopSpinner();return}for(n=JSON.parse(n),u.laceType=n.laceType,r=0,e=n.necklace.length;r<e;r++)f=new t(i.getBead(n.necklace[r].color,n.necklace[r].letter,u.defaultColor)),u.necklace.push(f),u.necklaceText+=f.letter!=="_"?f.letter:" ";i.stopSpinner()})}function k(n){var e,t,o,f;if(u.necklace&&u.necklace.length!==0){if(!n&&u.necklace&&u.necklace.length>0){u.displayError=!0;return}if(u.necklace&&u.necklace.length>0){for(e={necklace:[],laceType:{type:u.laceType.type,variation_id:u.laceType.variationId}},t=0,o=u.necklace.length;t<o;t++)f=u.necklace[t],e.necklace.push({color:f.color,letter:f.letter,variation_id:f.variation_id});i.addToCart(e).then(function(){(u.ordered=!0,typeof u.localStorage!="undefined")&&(u.localStorage.removeItem("necklace"),debug||r.location.assign("https://"+r.location.host+"/cart/"))},function(n){console.log(n);throw new Error("Error adding necklace to cart!");})}}}function d(){return i.getLaces()}function g(n){var t=n.find(".necklace");t.length!==0&&(e=angular.element(t[0]).width()/2,o=angular.element(t[0]).height()/2)}function nt(n){var t=n.find(".necklace");t.length!==0&&(s=parseInt(getComputedStyle(t[0]).paddingLeft.replace("px","")),h=parseInt(getComputedStyle(t[0]).paddingTop.replace("px","")),c=parseInt(getComputedStyle(t[0]).paddingRight.replace("px","")),v=parseInt(getComputedStyle(t[0]).paddingBottom.replace("px","")))}function tt(n){var f,o,e,c,r,s,h;if(u.confirm=!1,u.displayError=!1,angular.isDefined(n)&&n!==null)for(u.imagesLoaded=0,f=u.necklace,o=n.length,o<f.length&&f.splice(o,f.length-o),e=0,c=o;e<c;e++)if(r=f[e],s=n[e],r){if(r.letter!==s){if(r.letter==="_"&&s===" ")continue;h=new t(i.getBead(r.color,s));r.letter=h.letter;r.image_location=h.image_location}}else f[e]=new t(i.getBead(u.defaultColor,s))}function it(n){var i,r,t,u,s,h,c;if(angular.isDefined(n)&&n!==null&&n.length!==0){for(rt(n),i=ut(n,f),r=Math.floor(i.middleBead),t=r;t>=0;t--)bead=n[t],t===r?bead.position=a(i.offset,e,o,Math.sign(i.offset*-1)):(u=n[t+1].position.x,s=n[t+1].position.y,h=(bead.originalWidth*f+n[t+1].originalWidth*f)/2,bead.position=a(h,u,s,-1));for(t=r+1,l=n.length;t<l;t++)bead=n[t],u=n[t-1].position.x,s=n[t-1].position.y,h=(bead.originalWidth*f+n[t-1].originalWidth*f)/2,bead.position=a(h,u,s,1);for(c=ft(n),t=0,l=n.length;t<l;t++)bead=n[t],bead.position.correctionX=c.x,bead.position.correctionY=c.y,bead.width=bead.originalWidth*f,bead.height=bead.originalHeight*f}}function rt(n){for(var i,o=e*2-s-c,u=0,t=null,r=0,h=n.length;r<h;r++)i=n[r],i.originalWidth&&(u+=i.originalWidth),i.letter!=="_"&&(t=i);t||(t=n[0]);f=o/u;t.originalWidth*f<t.minWidth?f=t.minWidth/t.originalWidth:t.originalWidth*f>t.maxWidth&&(f=t.maxWidth/t.originalWidth)}function ut(n,t){for(var r,e,u,s,o=0,i=0,f=n.length;i<f;i++){if(r=n[i],!r.originalWidth)return{middleBead:n.length/2,offset:0};o+=r.originalWidth*t}for(e=o/2,u=0,i=0,f=n.length;i<f;i++){if(r=n[i],s=r.originalWidth*t,u+s>e)return{middleBead:i,offset:e-(u+r.originalWidth*t/2)};u+=r.originalWidth*t}}function ft(n){for(var t=null,i=0,y=n.length;i<y;i++)n[i].letter!=="_"&&(t=n[i]);t||(t=n[0]);var u=(t.position.x-e)*2+t.originalWidth*f,p=e*2-s-c,l=-(t.originalWidth*f/2);u>p&&(l+=u/2-e+s);var w=o*2-h-v,r=o+t.originalHeight*f-n[0].position.y,a=r/2;return r>w&&(a+=r/2-o+h),{x:l,y:a}}function a(n,t,i,r){var u,h;if(r===0)return{x:t,y:i,rotation:0};u={};u.x=t;for(var f=.002,c=n*n,s=0;s<c;)u.x+=.1*r,s=(-f*(u.x-e)*(u.x-e)-(i-o))*(-f*(u.x-e)*(u.x-e)-(i-o))+(u.x-t)*(u.x-t);return u.y=-f*(u.x-e)*(u.x-e)+o,h=2*-f*(u.x-e),u.rotation=Math.atan(h)*180/Math.PI,u}var u=this,e,o,f,s,h,c,v;u.selectedBead=null;u.defaultColor="army_green";u.laceType;u.necklaceText="";u.necklace=[];u.prices={};u.amounts={};u.confirm=!1;u.displayError=!1;u.ordered=!1;u.localStorage=window.localStorage;u.baseUrl=baseUrl;u.updatePrices=y;u.save=p;u.load=w;u.addToCart=k;u.getLaces=d;u.updateCenter=g;u.updatePadding=nt;u.convertToBeads=tt;u.positionBeads=it;w();window.onbeforeunload=p;n.$watchCollection(function(){return u.necklace},function(n){y(n)})}angular.module("MdbBeadConfig").controller("mdbBeadConfigController",["$scope","beadFactory","BeadService","$window",n])}(),function(){function n(n,t,i,r,u){function f(n,t,f,e){e.updatePadding(t);e.updateCenter(t);angular.element("body").on("click",function(){u.$emit("beadSelected")});n.$watch("ctrl.necklaceText",e.convertToBeads);angular.element(i).on("resize",function(){r(function(){e.updateCenter(t);e.positionBeads(e.necklace)})})}return{restrict:"E",scope:!0,templateUrl:baseUrl+"/templates/mdbBeadConfig.html",controller:"mdbBeadConfigController",controllerAs:"ctrl",link:f}}angular.module("MdbBeadConfig").directive("mdbBeadConfig",["beadFactory","BeadService","$window","$timeout","$rootScope",n])}(),function(){function n(n,t,i){function r(n){return n.addClass("bead"),u}function u(r,u,f,e){function h(t){t.stopPropagation();o.selected=!o.selected;o.selected?(u.addClass("selected"),n.$emit("beadSelected",o),e.selectedBead=o):(u.removeClass("selected"),e.selectedBead=null);i()}function c(n,t){o.selected&&t!==o&&(r.deselect(),r.$emit("mdbColorSelectorClose"))}function l(n){o.setColor(n)}var o=t(f.bead)(r),s;u.find("img").on("load",function(n){o.originalWidth=n.target.naturalWidth;o.originalHeight=n.target.naturalHeight;e.positionBeads(e.necklace);r.$apply()});o.maxWidth=parseInt(u.css("max-width").replace("px",""));o.minWidth=parseInt(u.css("min-width").replace("px",""));o.letter==="_"&&u.css("min-width","unset");r.setColor=l;r.$watch("bead.letter",function(n,t){n==="_"?u.css("min-width","unset"):t==="_"&&u.css("min-width",o.minWidth+"px")});r.$watch("bead.position",function(n){n&&(u.width(o.width),u.height(o.height),u.css({left:n.x+n.correctionX-o.width/2,top:n.y+n.correctionY-o.height,transform:"rotate("+n.rotation+"deg)",opacity:1}))},!0);u.on("click",h);r.deselect=function(){o.selected=!1;u.removeClass("selected");e.selectedBead===o&&(e.selectedBead=null);i()};s=n.$on("beadSelected",c);r.$on("$destroy",function(){s();e.positionBeads(e.necklace)})}return{restrict:"E",require:"^mdbBeadConfig",templateUrl:baseUrl+"/templates/mdbBead.html",compile:r}}angular.module("MdbBeadConfig").directive("mdbBead",["$rootScope","$parse","$timeout",n])}(),function(){function n(n){return function(t){function u(t){var r=n.getBead(t,i.letter);for(var u in r)i[u]=angular.copy(r[u])}var i=this,r;i.selected=!1;i.setColor=u;for(r in t)i[r]=angular.copy(t[r])}}angular.module("MdbBeadConfig").factory("beadFactory",["BeadService",n])}(),function(){function n(n,t){function i(i,r){i.beads=[];i.$watch("ctrl.selectedBead",function(t){t&&(i.beads=n.getBeadsByLetter(t.letter))});r.find(".content-wrap").on("click",function(n){n.stopPropagation()});i.close=function(){t.$emit("beadSelected")}}return{restrict:"E",priority:10,scope:!0,require:"^mdbBeadConfig",templateUrl:function(n,t){if(!t.templateUrl)throw new Error("No template url provided!");return baseUrl+t.templateUrl},link:i}}angular.module("MdbBeadConfig").directive("mdbColorSelector",["BeadService","$rootScope",n])}(),function(){"use strict";function n(n,t,i){function e(){o();var t="/wp-json/bead-config/v1/configurator-data/";return debug&&(t="data/beads.json"),r.loading=n({method:"GET",url:t}).then(function(n){var i,r,t,e;for(u=n.data.beads,i=0,r=n.data.laces.length;i<r;i++)t=n.data.laces[i],e=t.image?t.image.thumb_src:t.image_src,f.push({type:t.attributes.attribute_pa_veter_type,variationId:t.variation_id,image_src:e})},function(n){console.log("Error loading beads",n)}),r.loading}function s(){return f}function h(){return u}function c(){return Object.keys(u)}function l(n){var i=[],r,t;for(r in u)t=u[r][n],t&&i.push(t);return i}function a(n){var i=[],r,t;for(r in u[n])t=u[n][r],t&&i.push(t);return i}function v(n,t,i){t===" "&&(t="_");t=t.toLowerCase();!u[n][t]&&i&&(n=i);return angular.copy(u[n][t])}function y(r){return debug?t(function(){i(function(){},10)}):n({method:"POST",url:"/wp-json/bead-config/v1/add-to-cart/",data:{necklace:r.necklace,lace_type:r.laceType}})}function o(){var n=angular.element('<div class="loader-background"><div class="loader"><\/div>'),t=angular.element("body");t.append(n)}function p(){angular.element(".loader-background").remove()}var r=this,u,f=[];r.loading;r.loadBeads=e;r.getLaces=s;r.getBeads=h;r.getColors=c;r.getBeadsByLetter=l;r.getBeadsByColor=a;r.getBead=v;r.addToCart=y;r.startSpinner=o;r.stopSpinner=p;e()}angular.module("MdbBeadConfig").service("BeadService",["$http","$q","$timeout",n])}();