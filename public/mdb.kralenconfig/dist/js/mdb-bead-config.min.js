var debug=!0,baseUrl="/wp-content/plugins/mdb-kralen-config/public";debug&&(baseUrl="http://localhost:50049/"),function(){angular.module("MdbBeadConfig",["MdbControls"])}(),function(){function n(n,t,i,r){function f(n){var r=0,f=1,e=0,o=0,s=0,h=0,c=0,l=0,i,a,t;for(r+=f,i=0,a=n.length;i<a;i++){t=n[i];r+=parseFloat(t.price);switch(t.type){case"letter_bead":e+=parseFloat(t.price);h++;break;case"spacer_bead":t.size==="big"?(s+=parseFloat(t.price),l++):(o+=parseFloat(t.price),c++)}}u.prices={total:r.toFixed(2),lace:f.toFixed(2),letterBeads:e.toFixed(2),spacerBeadsSmall:o.toFixed(2),spacerBeadsBig:s.toFixed(2)};u.amounts={lace:1,letterBeads:h,spacerBeadsSmall:c,spacerBeadsBig:l}}function s(){u.laceType="round";u.necklaceText="";u.necklace=[];u.prices={};u.amounts={}}function e(){var t,n,r,i;if(!u.ordered&&typeof u.localStorage!="undefined"){if(u.necklace.length===0){u.localStorage.removeItem("necklace");return}for(t={laceType:u.laceType,necklace:[]},n=0,r=u.necklace.length;n<r;n++)i=u.necklace[n],t.necklace.push({color:i.color,letter:i.letter});u.localStorage.setItem("necklace",JSON.stringify(t))}}function o(){if(typeof u.localStorage=="undefined"){i.stopSpinner();return}var n=localStorage.getItem("necklace");s();i.loading.then(function(){var r,e,f;if(u.defaultColor=i.getColors()[0],!n){i.stopSpinner();return}for(n=JSON.parse(n),u.laceType=n.laceType,r=0,e=n.necklace.length;r<e;r++)f=new t(i.getBead(n.necklace[r].color,n.necklace[r].letter,u.defaultColor)),u.necklace.push(f),u.necklaceText+=f.letter;i.stopSpinner()})}function h(){for(var n,f={necklace:[],laceType:u.laceType},t=0,e=u.necklace.length;t<e;t++)n=u.necklace[t],f.necklace.push({color:n.color,letter:n.letter,variation_id:n.variation_id});i.addToCart(f).then(function(){(u.ordered=!0,typeof u.localStorage!="undefined")&&(u.localStorage.removeItem("necklace"),debug||r.location.assign("https://"+r.location.host+"/cart/"))},function(n){console.log(n);throw new Error("Error adding necklace to cart!");})}var u=this;u.defaultColor="army_green";u.laceType="round";u.necklaceText="";u.necklace=[];u.prices={};u.amounts={};u.ordered=!1;u.localStorage=window.localStorage;u.baseUrl=baseUrl;u.updatePrices=f;u.save=e;u.load=o;u.addToCart=h;o();window.onbeforeunload=e;n.$watchCollection(function(){return u.necklace},function(n){f(n)})}angular.module("MdbBeadConfig").controller("mdbBeadConfigController",["$scope","beadFactory","BeadService","$window",n])}(),function(){function s(s,h,c,a,v){function y(y,p,w,b){function g(){var n=p.find(".necklace");n.length!==0&&(r=parseInt(getComputedStyle(n[0]).paddingLeft.replace("px","")),u=parseInt(getComputedStyle(n[0]).paddingTop.replace("px","")),f=parseInt(getComputedStyle(n[0]).paddingRight.replace("px","")),o=parseInt(getComputedStyle(n[0]).paddingBottom.replace("px","")))}function nt(n){var i,r,t,f,u;if(angular.isDefined(n)&&n!==null)for(i=b.necklace,r=n.length,r<i.length&&i.splice(r,i.length-r),t=0,f=r;t<f;t++)if(u=i[t],u){if(u.letter!==n[t]){if(u.letter==="_"&&n[t]===" ")continue;u.letter=n[t]}}else i[t]=new s(h.getBead(b.defaultColor,n[t]))}function k(r){var c,o,u,f,s,h,a;if(angular.isDefined(r)&&r!==null&&r.length!==0){for(tt(r),c=b.necklace.length/2,o=Math.round(c),u=o-1;u>=0;u--)f=r[u],u===o-1?f.position=o!==c?e(0,n,i,1):e(t/2,n,i,-1):(s=r[u+1].position.x,h=r[u+1].position.y,f.position=e(t,s,h,-1));for(u=o,l=r.length;u<l;u++)f=r[u],s=r[u-1].position.x,h=r[u-1].position.y,f.position=e(t,s,h,1);for(a=it(r),u=0,l=r.length;u<l;u++)f=r[u],f.position.correctionX=a.x,f.position.correctionY=a.y,f.position.size=t}}function tt(e){var c=(n*2-r-f)/e.length,h=angular.element("mdb-bead.bead"),l,s;h.length>0&&(t=parseInt(getComputedStyle(h[0]).width.replace("px","")),l=parseInt(getComputedStyle(h[0]).minWidth.replace("px","")),s=parseInt(getComputedStyle(h[0]).maxWidth.replace("px","")),s||(s=n>=i?i*2-u-o:n*2-r-f),t=c<l?l:c>s?s:c)}function d(){var t=p.find(".necklace");t.length!==0&&(n=angular.element(t[0]).width()/2,i=angular.element(t[0]).height()/2)}function it(e){var h=(e[e.length-1].position.x-n)*2+t,a=n*2-r-f,c=-(t/2);h>a&&(c+=h/2-n+r);var v=i*2-u-o,s=i+t-e[0].position.y,l=s/2-t;return s>v&&(l+=s/2-i+u),{x:c,y:l}}g();d();h.loading.then(function(){y.fakeBead=new s(h.getBead(b.defaultColor,"a"));y.fakeBead.position={x:-1e3,y:-1e3};p.append('<mdb-bead bead="fakeBead" class="bead"><\/mdb-bead>')});y.$watch("ctrl.necklaceText",nt);y.$watchCollection("ctrl.necklace",k);angular.element(c).on("resize",function(){v.$broadcast("mdbColorSelectorClose");a(function(){d();k(b.necklace)})})}return{restrict:"E",scope:!0,templateUrl:baseUrl+"/Templates/mdbBeadConfig.html",controller:"mdbBeadConfigController",controllerAs:"ctrl",link:y}}function e(t,r,u,f){var e={},h;e.x=r;for(var o=.002,c=t*t,s=0;s<c;)e.x+=.1*f,s=(-o*(e.x-n)*(e.x-n)-(u-i))*(-o*(e.x-n)*(e.x-n)-(u-i))+(e.x-r)*(e.x-r);return e.y=-o*(e.x-n)*(e.x-n)+i,h=2*-o*(e.x-n),e.rotation=Math.atan(h)*180/Math.PI,e}angular.module("MdbBeadConfig").directive("mdbBeadConfig",["beadFactory","BeadService","$window","$timeout","$rootScope",s]);var n,i,t,r,u,f,o}(),function(){function n(n,t){function i(n){return n.addClass("bead"),r}function r(i,r,u){function o(t){t.stopPropagation();f.selected=!f.selected;f.selected?(r.addClass("selected"),n.$emit("beadSelected",f)):r.removeClass("selected")}function s(n,t){f.selected&&t!==f&&(i.deselect(),i.$emit("mdbColorSelectorClose"))}function h(n){f.setColor(n)}var f=t(u.bead)(i),e;i.setColor=h;i.$watch("bead.position",function(n){n&&(r.width(n.size),r.height(n.size),r.css({left:n.x+n.correctionX,top:n.y+n.correctionY,transform:"rotate("+n.rotation+"deg)",opacity:1}))},!0);r.on("click",o);i.deselect=function(){f.selected=!1;r.removeClass("selected")};e=n.$on("beadSelected",s);i.$on("$destroy",function(){e()})}return{restrict:"E",controller:function(){},templateUrl:baseUrl+"/Templates/mdbBead.html",compile:i}}angular.module("MdbBeadConfig").directive("mdbBead",["$rootScope","$parse",n])}(),function(){function n(n){return function(t){function u(t){var r=n.getBead(t,i.letter);for(var u in r)i[u]=angular.copy(r[u])}var i=this,r;i.selected=!1;i.setColor=u;for(r in t)i[r]=angular.copy(t[r])}}angular.module("MdbBeadConfig").factory("beadFactory",["BeadService",n])}(),function(){function n(n,t,i){function r(n,t,r){var u,f;n.selectedBead=n.bead;n.beads=i.getBeadsByLetter(n.selectedBead.letter);u=r.mdbColorSelectorOffsetX;u=u?parseInt(u):0;f=r.mdbColorSelectorOffsetY;f=f?parseInt(f):0}return{restrict:"A",priority:10,require:"^mdbBeadConfigController",templateUrl:function(n,t){if(!t.mdbColorSelector)throw new Error("No template url provided!");return t.mdbColorSelector},link:r}}function t(){function n(n,t){t.on("click",function(n){n.stopPropagation()});t.find(".fa-close, .glyphicon-remove").on("click",function(){n.$emit("mdbColorSelectorClose")})}return{restrict:"E",templateUrl:function(n,t){if(!t.mdbTemplateUrl)throw new Error("No template url provided!");return t.mdbTemplateUrl},link:n}}angular.module("MdbBeadConfig").directive("mdbColorSelector",["$compile","$parse","BeadService",n]);angular.module("MdbBeadConfig").directive("mdbColorSelectorWindow",[t])}(),function(){"use strict";function n(n,t,i){function f(){e();var t="/wp-json/bead-config/v1/plugin-settings/";return debug&&(t="data/beads.json"),r.loading=n({method:"GET",url:t}).then(function(n){u=n.data.settings.beads},function(n){console.log("Error loading beads",n)}),r.loading}function o(){return u}function s(){return Object.keys(u)}function h(n){var i=[],r,t;for(r in u)t=u[r][n],t&&i.push(t);return i}function c(n){var i=[],r,t;for(r in u[n])t=u[n][r],t&&i.push(t);return i}function l(n,t,i){t===" "&&(t="_");t=t.toLowerCase();!u[n][t]&&i&&(n=i);return angular.copy(u[n][t])}function a(r){return debug?t(function(){i(function(){},10)}):n({method:"POST",url:"/wp-json/bead-config/v1/add-to-cart/",data:{necklace:r.necklace,lace_type:r.laceType}})}function e(){var n=angular.element('<div class="loader-background"><div class="loader"><\/div>'),t=angular.element("body");t.append(n)}function v(){angular.element(".loader-background").remove()}var r=this,u;r.loading;r.loadBeads=f;r.getBeads=o;r.getColors=s;r.getBeadsByLetter=h;r.getBeadsByColor=c;r.getBead=l;r.addToCart=a;r.startSpinner=e;r.stopSpinner=v;f()}angular.module("MdbBeadConfig").service("BeadService",["$http","$q","$timeout",n])}();