var debug=!0,baseUrl="/wp-content/plugins/mdb-kralen-config/public";debug&&(baseUrl="http://localhost:50049/"),function(){angular.module("MdbBeadConfig",["MdbControls"])}(),function(){function n(n,t,i,r){function v(){var i=0,r=u.laceType?u.laceType.display_price:0,f=0,e=0,o=0,a=u.laceType?1:0,s=0,h=0,c=0,t,l,n;for(i+=r,t=0,l=u.necklace.length;t<l;t++){n=u.necklace[t];i+=parseFloat(n.price);switch(n.type){case"letter_bead":f+=parseFloat(n.price);s++;break;case"spacer_bead":n.size==="big"?(o+=parseFloat(n.price),c++):(e+=parseFloat(n.price),h++)}}u.prices={total:i.toFixed(2),lace:r.toFixed(2),letterBeads:f.toFixed(2),spacerBeadsSmall:e.toFixed(2),spacerBeadsBig:o.toFixed(2)};u.amounts={lace:a,letterBeads:s,spacerBeadsSmall:h,spacerBeadsBig:c}}function b(){u.laceType=i.getLaces()[0];u.necklaceText="";u.necklace=[];u.prices={};u.amounts={};u.updatePrices()}function y(){var t,n,r,i;if(!u.ordered&&typeof u.localStorage!="undefined"){if(u.necklace.length===0){u.localStorage.removeItem("necklace");return}for(t={laceType:u.laceType,necklace:[]},n=0,r=u.necklace.length;n<r;n++)i=u.necklace[n],t.necklace.push({color:i.color,letter:i.letter});u.localStorage.setItem("necklace",JSON.stringify(t))}}function p(){i.loading.then(function(){var n,r,e,f;if(b(),u.defaultColor=i.getColors()[0],typeof u.localStorage=="undefined"){i.stopSpinner();return}if(n=localStorage.getItem("necklace"),!n){i.stopSpinner();return}for(n=JSON.parse(n),u.laceType=n.laceType,r=0,e=n.necklace.length;r<e;r++)f=new t(i.getBead(n.necklace[r].color,n.necklace[r].letter,u.defaultColor)),u.necklace.push(f),u.necklaceText+=f.letter!=="_"?f.letter:" ";i.stopSpinner()})}function k(n){var e,t,o,f;if(u.necklace&&u.necklace.length!==0){if(!n&&u.necklace&&u.necklace.length>0){u.displayError=!0;return}if(u.necklace&&u.necklace.length>0){for(e={necklace:[],laceType:{type:u.laceType.type,variation_id:u.laceType.variationId}},t=0,o=u.necklace.length;t<o;t++)f=u.necklace[t],e.necklace.push({color:f.color,letter:f.letter,variation_id:f.variation_id});i.addToCart(e).then(function(){(u.ordered=!0,typeof u.localStorage!="undefined")&&(u.localStorage.removeItem("necklace"),debug||r.location.assign("https://"+r.location.host+"/cart/"))},function(n){console.log(n);throw new Error("Error adding necklace to cart!");})}}}function d(){return i.getLaces()}function g(n){var t=n.find(".necklace");t.length!==0&&(f=angular.element(t[0]).width()/2,e=angular.element(t[0]).height()/2)}function nt(n){var t=n.find(".necklace");t.length!==0&&(o=parseInt(getComputedStyle(t[0]).paddingLeft.replace("px","")),s=parseInt(getComputedStyle(t[0]).paddingTop.replace("px","")),h=parseInt(getComputedStyle(t[0]).paddingRight.replace("px","")),a=parseInt(getComputedStyle(t[0]).paddingBottom.replace("px","")))}function tt(n){u.confirm=!1;u.displayError=!1;var t=n.currentTarget.selectionStart,i=n.currentTarget.selectionEnd;t===i&&n.which===8?t>0&&(u.necklace.splice(t-1,1),u.positionBeads(u.necklace)):t===i&&n.which===46?t<u.necklace.length&&(u.necklace.splice(t,1),u.positionBeads(u.necklace)):i-t&&(u.necklace.splice(t,i-t),u.positionBeads(u.necklace))}function it(n){var r=String.fromCharCode(n.charCode),f,e;if(!w.test(r))return n.preventDefault(),!1;f=n.currentTarget.selectionStart;e=new t(i.getBead(u.defaultColor,r));u.necklace.splice(f,0,e)}function rt(n){return n.preventDefault(),!1}function ut(n){var i,r,o,t,s,h,a;if(angular.isDefined(n)&&n!==null&&n.length!==0&&(i=ft(n),i)){for(r=et(n,i),o=Math.floor(r.middleBead),t=o;t>=0;t--)bead=n[t],t===o?(bead.position=c(r.offset,f,e,Math.sign(r.offset*-1)),bead.width=bead.originalWidth*i,bead.height=bead.originalHeight*i):(s=n[t+1].position.x,h=n[t+1].position.y,bead.width=bead.originalWidth*i,bead.height=bead.originalHeight*i,a=(bead.width+n[t+1].width)/2+5*i,bead.position=c(a,s,h,-1));for(t=o+1,l=n.length;t<l;t++)bead=n[t],s=n[t-1].position.x,h=n[t-1].position.y,bead.width=bead.originalWidth*i,bead.height=bead.originalHeight*i,a=(bead.width+n[t-1].width)/2+5*i,bead.position=c(a,s,h,1);u.correction=ot(n)}}function ft(n){for(var r,i=1,s=f*2-o-h,e=0,t=null,u=0,c=n.length;u<c;u++){if(r=n[u],!r.originalWidth)return;e+=r.originalWidth;r.letter!=="_"&&(!t||r.originalWidth>t.originalWidth)&&(t=r)}return t||(t=n[0]),i=s/e,t.originalWidth*i<t.minWidth?i=t.minWidth/t.originalWidth:t.originalWidth*i>t.maxWidth&&(i=t.maxWidth/t.originalWidth),i}function et(n,t){for(var r,e,u,s,o=0,i=0,f=n.length;i<f;i++){if(r=n[i],!r.originalWidth)return{middleBead:n.length/2,offset:0};o+=r.originalWidth*t}for(e=o/2,u=0,i=0,f=n.length;i<f;i++){if(r=n[i],s=r.originalWidth*t,u+s>e)return{middleBead:i,offset:e-(u+r.originalWidth*t/2)};u+=r.originalWidth*t}}function ot(n){for(var t=null,i=0,v=n.length;i<v;i++)if(n[i].letter!=="_"){t=n[i];break}t||(t=n[0]);var u=(f-n[0].position.x)*2+t.width,y=f*2-o-h,c=0;u>y&&(c+=u/2-f+o);var p=e*2-s-a,r=e+t.height-n[0].position.y,l=r/2;return r>p&&(l+=r/2-e+s),{x:c,y:l}}function c(n,t,i,r){var u,h;if(r===0)return{x:t,y:i,rotation:0};u={};u.x=t;for(var o=.002,c=n*n,s=0;s<c;)u.x+=.1*r,s=(-o*(u.x-f)*(u.x-f)-(i-e))*(-o*(u.x-f)*(u.x-f)-(i-e))+(u.x-t)*(u.x-t);return u.y=-o*(u.x-f)*(u.x-f)+e,h=2*-o*(u.x-f),u.rotation=Math.atan(h)*180/Math.PI,u}var u=this,f,e,o,s,h,a,w=/[a-zA-Z0-9\s]/;u.selectedBead=null;u.defaultColor="army_green";u.laceType;u.necklaceText="";u.necklace=[];u.prices={};u.amounts={};u.confirm=!1;u.displayError=!1;u.ordered=!1;u.localStorage=window.localStorage;u.baseUrl=baseUrl;u.updatePrices=v;u.save=y;u.load=p;u.addToCart=k;u.getLaces=d;u.updateCenter=g;u.updatePadding=nt;u.positionBeads=ut;u.removeBeads=tt;u.addBead=it;u.preventPaste=rt;p();window.onbeforeunload=y;n.$watchCollection(function(){return u.necklace},function(n){v(n)})}angular.module("MdbBeadConfig").controller("mdbBeadConfigController",["$scope","beadFactory","BeadService","$window",n])}(),function(){function n(n,t,i,r,u){function f(n,t,f,e){e.updatePadding(t);e.updateCenter(t);angular.element("body").on("click",function(){u.$emit("beadSelected")});angular.element(i).on("resize",function(){r(function(){e.updateCenter(t)})})}return{restrict:"E",scope:!0,templateUrl:baseUrl+"/templates/mdbBeadConfig.html",controller:"mdbBeadConfigController",controllerAs:"ctrl",link:f}}angular.module("MdbBeadConfig").directive("mdbBeadConfig",["beadFactory","BeadService","$window","$timeout","$rootScope",n])}(),function(){function n(n,t,i){function r(n){return n.addClass("bead"),u}function u(r,u,f,e){function h(t){t.stopPropagation();o.selected=!o.selected;o.selected?(u.addClass("selected"),n.$emit("beadSelected",o),e.selectedBead=o):(u.removeClass("selected"),e.selectedBead=null);i()}function c(n,t){o.selected&&t!==o&&(r.deselect(),r.$emit("mdbColorSelectorClose"))}function l(n){o.setColor(n)}var o=t(f.bead)(r),s;u.css({opacity:0});u.find("img").on("load",function(n){o.originalWidth=n.target.naturalWidth;o.originalHeight=n.target.naturalHeight;e.positionBeads(e.necklace);r.$apply()});o.maxWidth=parseInt(u.css("max-width").replace("px",""));o.minWidth=parseInt(u.css("min-width").replace("px",""));o.letter==="_"&&(u.css("min-width","unset"),u.addClass("small"));r.setColor=l;r.$watch("bead.letter",function(n,t){n==="_"?(u.css("min-width","unset"),u.addClass("small"),o.maxWidth=parseInt(u.css("max-width").replace("px",""))):t==="_"&&(u.css("min-width",o.minWidth+"px"),u.removeClass("small"),o.maxWidth=parseInt(u.css("max-width").replace("px","")))});r.$watch("bead.position",function(n){n&&(u.width(o.width),u.height(o.height),u.css({left:n.x+e.correction.x-o.width/2,top:n.y+e.correction.y-o.height,transform:"rotate("+n.rotation+"deg)",opacity:1}))},!0);u.on("click",h);r.deselect=function(){o.selected=!1;u.removeClass("selected");e.selectedBead===o&&(e.selectedBead=null);i()};s=n.$on("beadSelected",c);r.$on("$destroy",function(){s()})}return{restrict:"E",require:"^mdbBeadConfig",templateUrl:baseUrl+"/templates/mdbBead.html",compile:r}}angular.module("MdbBeadConfig").directive("mdbBead",["$rootScope","$parse","$timeout",n])}(),function(){function n(n){return function(t){function u(t){var r=n.getBead(t,i.letter);for(var u in r)i[u]=angular.copy(r[u])}var i=this,r;i.selected=!1;i.setColor=u;for(r in t)i[r]=angular.copy(t[r])}}angular.module("MdbBeadConfig").factory("beadFactory",["BeadService",n])}(),function(){function n(n,t){function i(i,r){i.beads=[];i.$watch("ctrl.selectedBead",function(t){t&&(i.beads=n.getBeadsByLetter(t.letter),i.beads.sort(function(n,t){return n.order-t.order}))});r.find(".content-wrap").on("click",function(n){n.stopPropagation()});i.close=function(){t.$emit("beadSelected")}}return{restrict:"E",priority:10,scope:!0,require:"^mdbBeadConfig",templateUrl:function(n,t){if(!t.templateUrl)throw new Error("No template url provided!");return baseUrl+t.templateUrl},link:i}}angular.module("MdbBeadConfig").directive("mdbColorSelector",["BeadService","$rootScope",n])}(),function(){"use strict";function n(n,t,i){function e(){o();var t="/wp-json/bead-config/v1/configurator-data/";return debug&&(t="data/beads.json"),r.loading=n({method:"GET",url:t}).then(function(n){var i,r,t,e;for(u=n.data.beads,i=0,r=n.data.laces.length;i<r;i++)t=n.data.laces[i],e=t.image?t.image.thumb_src:t.image_src,f.push({type:t.attributes.attribute_pa_veter_type,variationId:t.variation_id,image_src:e,display_price:t.display_price})},function(n){console.log("Error loading beads",n)}),r.loading}function s(){return f}function h(){return u}function c(){return Object.keys(u)}function l(n){var i=[],r,t;for(r in u)t=u[r][n],t&&i.push(t);return i}function a(n){var i=[],r,t;for(r in u[n])t=u[n][r],t&&i.push(t);return i}function v(n,t,i){t===" "&&(t="_");t=t.toLowerCase();!u[n][t]&&i&&(n=i);return angular.copy(u[n][t])}function y(r){return debug?t(function(){i(function(){},10)}):n({method:"POST",url:"/wp-json/bead-config/v1/add-to-cart/",data:{necklace:r.necklace,lace_type:r.laceType}})}function o(){var n=angular.element('<div class="loader-background"><div class="loader"><\/div>'),t=angular.element("body");t.append(n)}function p(){angular.element(".loader-background").remove()}var r=this,u,f=[];r.loading;r.loadBeads=e;r.getLaces=s;r.getBeads=h;r.getColors=c;r.getBeadsByLetter=l;r.getBeadsByColor=a;r.getBead=v;r.addToCart=y;r.startSpinner=o;r.stopSpinner=p;e()}angular.module("MdbBeadConfig").service("BeadService",["$http","$q","$timeout",n])}();